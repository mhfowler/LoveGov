<!-- HTML -->
<div id="match-main">

    <div id="match-mid-header">
        <h5>Featured Matches</h5>
    </div>

    <!-- Content Section -->
    <div id="match-mid">

        <div id="match-mid-content">

            <div id="match-arrow-left" class="match-arrow">
                <img src="/static/images/match/arrow_left_light.png"/>
            </div>

            <div id="match-ajax-content">

                <div class="match-presidential match-section" data-sequence="0">
                    {% include 'deployment/pages/match/match-tryptic-template.html' with prof1=presidential.0 prof2=presidential.1 prof3=presidential.2 match_title="Your 2012 Presidential Candidates" %}
                </div>

                <div class="match-massachusettes match-section" data-sequence="1">
                    {% include 'deployment/pages/match/match-tryptic-template.html' with prof1=elizabeth prof2=mass prof3=brown match_title="Your Massachusettes Senate Election" %}
                </div>

                <div class="match-social match-section" data-sequence="2">
                    {% include 'deployment/pages/match/match-social.html' %}
                </div>

                <div class="match-representatives match-section" data-sequence="3">
                    {% if congressmen %}
                        {% include 'deployment/pages/match/match-tryptic-template.html' with prof1=congressmen.0 prof2=congressmen.1 prof3=congressmen.2 match_title="Find Your Congressmen" %}
                    {% else %}
                        <div class="match-title">
                            <h3>Find Your Congressmen</h3>
                        </div>
                        {% if invalid_address %}
                            <p>
                                We could not find any congressmen associated with the last address you entered. You could try entering the
                                address again or lookup a different one.
                            </p>
                        {% endif %}
                        {% include 'deployment/pages/match/address.html' %}
                    {% endif %}
                    <div style="clear:both"></div>
                    <div class="address-wrapper">

                        {% if state and district and longitude and latitude %}
                        <div id="map_canvas" style='width:930px;height:500px'>

                        </div>
                        {% endif %}

                        {% if not invalid_address %}
                            <div class="new-address-wrapper">
                                {% include 'deployment/pages/match/address.html' %}
                            </div>
                        {% endif %}
                    </div>
                </div>

            </div>

        </div>

        <div id="match-arrow-right" class="match-arrow">
            <img src="/static/images/match/arrow_right_light.png"/>
        </div>

    </div>

    <div class="clear-both"></div>

<!-- Red/Gray Circles -->
{% include 'deployment/pages/match/match-selection-line-break.html' %}

<!-- QuickLinks -->
{% include 'deployment/pages/match/match-quicklinks.html' %}

</div>
<div class="first-login-modal">
    <div class="modal-close"></div>
    <div class="first-login-content"></div>
</div>

<script type="text/javascript">
    rebind = 'match';

    match_current_section={{ start_sequence }};

    {% if state and district and longitude and latitude %}

    match_location = true;

    match_state = "{{ state }}";
    match_district = "{{ district }}";
    match_longtitude = "{{ longitude }}";
    match_latitude = "{{ latitude }}";

    {% endif %}

    {% if firstLoginStage < 3 or firstLoginStage == 5%}

    var firstLoginStage = {{ firstLoginStage }};

    var fl_modal = $('div.first-login-modal');

    var skipTutorialText = '<div class="skip-tutorial">Prefer to browse the site? <a>Skip</a> the tutorial.</div>';

    function stageZero() {
        launchFirstLoginModal('<h2>Welcome to LoveGov</h2><p>We are currently in Beta, so this site is a work in progress. ' +
                'To find out more about what we are trying to do, visit ' +
                'our <a href="/about">About</a> page. We would love any feedback you may have.</p>' +
                '<p>Weâ€™ve built some neat tools to help you stay informed and get involved in politics. ' +
                '<button class="tutorial-button">Learn how it works</button>' + skipTutorialText);
        $('button.tutorial-button').bindOnce('click', function() {
            setFirstLoginStage('1', stageOne);
        });
        bindSkipFirstLogin();
    }

    function stageOne() {
        launchFirstLoginModal('<p>Right now you\'re browsing the match page. Use this page to see how your beliefs match ' +
                'with politicians, groups, and friends.</p>' +
                '<p>Try finding the representatives for your congressional district.</p>' +
                '<div class="zip-code-form"><input type="text" class="firstlogin-zipcode" placeholder="Your zip code">' +
                '<button class="tutorial-button">Go</button></div>' +
                '<div class="skip-tutorial"><a>Skip this step</a></div>');
        $('button.tutorial-button').bindOnce('click', function() {
            var zip = $('input.firstlogin-zipcode').val();
            submitZip(zip);
            setFirstLoginStage(2, function() {
                window.location = '/match/representatives'
            });
        });
        $('div.skip-tutorial a').bindOnce('click', function() {
            setFirstLoginStage(3, function() {
                window.location = '/web';
            });
        });
    }

    function stageTwo() {
        launchFirstLoginModal('<p>Awesome! Here are your representatives. ' +
                'Notice that your match percentage is at 0%.</p>' +
                '<p>Answer some questions to begin comparing your views with your representatives.</p>' +
                '<button class="tutorial-button">Jump to Q&A Web</button>' +
                '<div class="skip-tutorial">Not your voting district? <a>Enter a new address.</a></div>');
        $('button.tutorial-button').bindOnce('click', function() {
            setFirstLoginStage(3, function() {window.location = "/web";});
        });
        $('div.skip-tutorial a').bindOnce('click', function() {
            stageOne();
        });

    }



    function stageFive() {
        launchFirstLoginModal('<p>See how your match percentages have changed? The more questions you answer' +
                ' the more accurate this number becomes.</p>' +
                '<p>Finally, the feed is where you can discuss news and check out content submitted by ' +
                'the LoveGov community. Clicking the LoveGov logo will always take you to the feed.</p>' +
                '<button class="tutorial-button">Jump to Feed</button>');
        $('button.tutorial-button').bindOnce('click', function() {
            var success = function() {
                window.location = '/feed';
            };
            setFirstLoginStage('6', success);
        });
     }

    function bindSkipFirstLogin() {
        $('div.skip-tutorial a').bindOnce('click', function() {
            var success = function() {
                $('div.first-login-modal').hide();
            };
            setFirstLoginStage('7', success);
        });
    }

    switch (firstLoginStage) {
        case 0: stageZero(); break;
        case 1: stageOne(); break;
        case 2: stageTwo(); break;
        case 5: stageFive(); break;
    }

    <!-- /first login -->
    {% endif %}

</script>



